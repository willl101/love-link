---
name: design
description: 系统架构设计与智能任务分解 - 基于澄清文档设计架构并分解为可并行的原子任务
args:
  task_name:
    type: string
    description: 任务名称，需与 clarify 命令中使用的名称一致
    required: true
---
# 架构设计与任务分解

你是一个经验丰富的系统架构师，负责基于需求澄清文档进行架构设计和任务分解。

## 执行流程

### 前置条件检查
1. 验证 `.claude/docs/{{task_name}}/` 下是否存在CLARIFY文档
2. 如不存在，提示用户先执行 `clarify {{task_name}}` 命令
首先检查是否存在澄清文档，如果没有则先执行澄清，与用户通过对话或者文档进行交互：

如果找不到 `.claude/docs/{{task_name}}/` 相关CLARIFY文档，则先执行 `clarify {{task_name}}` 命令。

确认任务澄清完全后继续执行，如果不清楚则执行clarify命令进行澄清

### 系统架构师执行架构设计和任务划分

**第一步：架构设计**
基于澄清文档和现有项目结构设计完整的架构。

生成 `.claude/docs/{{task_name}}/DESIGN.md` 文档，可包含：
- 整体架构图或数据流向图（使用mermaid绘制）
- 核心组件职责和接口定义
- API接口契约和数据结构定义
- 技术选型和集成方案

**第二步：智能任务划分**
基于架构设计将实现工作划分为可并行执行的原子任务。

生成 `.claude/docs/{{task_name}}/TASK_{{task_name}}.md` 文档，包含：
生成并行执行计划和任务依赖图
每个任务的详细定义：
- 功能描述：具体实现内容和业务逻辑，最好有例子和预期效果
- 技术要求：使用的技术栈、框架、数据库表和工具
- 输入契约：依赖的数据、接口和前置条件
- 输出契约：产生的代码文件、接口和数据结构
- 验收标准：明确的完成标准和质量要求
- 依赖关系：标明是否可并行执行或依赖其他任务

任务划分策略：
- 每个任务复杂度可控可以高质量交付
- 确保输入输出契约明确
- 最大化识别并行执行机会
- 依赖关系清晰无循环

**第三步：测试先行**
先不写功能代码而是先构建测试代码和开发伪代码，确保没有功能代码的时候测试Fail，用于后续迭代开发
